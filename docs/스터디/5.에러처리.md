# 5. 에러 처리: 프론트엔드에 어떻게 전달되는가?

[← 목차로 돌아가기](./0.목차.md) | [← 이전: 게이트웨이](./4.게이트웨이.md)

---

## 5.1 에러의 두 가지 유형

MCP에서 에러는 크게 두 가지로 나뉩니다:

```
┌─────────────────────────────────────────────────────────────────┐
│                     에러 유형 구분                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   [1] Tool Error (비즈니스 로직 실패)                           │
│   ────────────────────────────────────────────────────────────  │
│   - HTTP 200 OK                                                 │
│   - result.isError = true                                       │
│   - 예: "검색 결과가 없습니다", "이미 존재하는 이슈입니다"      │
│                                                                 │
│   {                                                             │
│     "jsonrpc": "2.0",                                           │
│     "id": "req-001",                                            │
│     "result": {                                                 │
│       "content": [{ "type": "text", "text": "결과가 없습니다" }],│
│       "isError": false  // 또는 true                            │
│     }                                                           │
│   }                                                             │
│                                                                 │
│   → 프론트: 일반 결과처럼 표시 (빨간색 강조 등)                 │
│                                                                 │
│   [2] System Error (시스템 레벨 실패)                           │
│   ────────────────────────────────────────────────────────────  │
│   - JSON-RPC error 객체                                         │
│   - 예: 권한 없음, 서버 다운, 타임아웃                          │
│                                                                 │
│   {                                                             │
│     "jsonrpc": "2.0",                                           │
│     "id": "req-001",                                            │
│     "error": {                                                  │
│       "code": -32600,                                           │
│       "message": "권한이 없습니다",                              │
│       "data": {                                                 │
│         "required_role": "HR_MANAGER",                          │
│         "current_role": "USER",                                 │
│         "action": "request_permission"                          │
│       }                                                         │
│     }                                                           │
│   }                                                             │
│                                                                 │
│   → 프론트: 토스트/모달로 에러 표시, data 기반 액션 유도        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5.2 주요 에러 코드 및 프론트 대응

| 에러 코드 | 의미 | 프론트엔드 대응 |
|-----------|------|-----------------|
| `-32600` | Invalid Request | 입력값 검증 실패 메시지 표시 |
| `-32601` | Method not found | 도구가 없음 메시지 표시 |
| `-32602` | Invalid params | 파라미터 오류 메시지 표시 |
| `-32603` | Internal error | 서버 오류 토스트 + 재시도 버튼 |
| 커스텀 | 권한 없음 | "권한 요청" 버튼 표시 (`data.action` 활용) |
| 커스텀 | Rate Limit | 남은 시간 표시 (`data.retry_after` 활용) |
| 커스텀 | Personal Key 없음 | "키 등록하기" 버튼 표시 |

---

## 5.3 에러 응답 설계 시 고려사항

```typescript
// ❌ 나쁜 예: 에러 정보가 부족함
{
  "error": {
    "code": -32600,
    "message": "권한이 없습니다"
  }
}

// ✅ 좋은 예: 프론트가 액션을 취할 수 있는 정보 포함
{
  "error": {
    "code": -32600,
    "message": "권한이 없습니다",
    "data": {
      "required_role": "HR_MANAGER",      // 필요한 권한
      "current_role": "USER",             // 현재 권한
      "action": "request_permission",      // 권장 액션
      "request_url": "/admin/permission"   // 액션 URL
    }
  }
}
```

---

## 5.4 게이트웨이에서 에러 처리 시 주의점

**⚠️ 에러를 "꿀꺽"하지 말 것!**

```
┌─────────────────────────────────────────────────────────────────┐
│                    에러 처리 안티패턴                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   [잘못된 처리]                                                  │
│   MCP 서버: { "error": { "code": -32603, "message": "DB 오류" } }│
│                          │                                      │
│                          ▼                                      │
│   MCPHUB:    { "result": { "text": "오류가 발생했습니다" } }     │
│              ↑                                                  │
│              └── 에러를 성공 응답으로 변환 (❌)                  │
│                                                                 │
│   문제점:                                                        │
│   - AI가 성공으로 오인 → 잘못된 후속 행동                       │
│   - 프론트가 에러 분기 처리 불가                                │
│   - 디버깅 정보 손실                                            │
│                                                                 │
│   [올바른 처리]                                                  │
│   MCP 서버: { "error": { "code": -32603, "message": "DB 오류" } }│
│                          │                                      │
│                          ▼                                      │
│   MCPHUB:    { "error": { "code": -32603, "message": "DB 오류",  │
│                           "data": { "server": "jira-mcp" } } }  │
│              ↑                                                  │
│              └── 원본 에러 구조 유지 + 메타데이터 추가 (✅)      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

[다음: 인증권한 →](./6.인증권한.md)
