# MCPHUB 검증용 테스트 서버 명세

이 문서는 **실제로 구현된 MCP 서버 스펙**을 정의합니다.  
AI가 이 서버의 도구/프롬프트를 사용할 때 참고하는 문서입니다.


---

## 서버 정보

- **Transport**: Streamable HTTP + stdio
- **HTTP endpoint**: `POST /mcp`
- **Health**: `GET /health`
- **기본 포트**: `3333`

---

## Tool 명세

### ProtocolModule

#### `provision_cloud_resource`

복잡한 JSON Schema(enum/array/nested object)가 프론트까지 전달되는지 확인하는 도구.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `provider` | enum(`aws`, `gcp`, `azure`) | 클라우드 제공자 |
| `resourceType` | enum(`vm`, `storage`, `database`) | 리소스 유형 |
| `tags` | string[] | 태그 목록 |
| `options.region` | string | 배포 리전 |
| `options.autoScaling` | boolean | 오토스케일링 활성화 |

**Output**: 입력값을 포함한 성공 응답 JSON

---

#### `get_server_metrics_chart`

이미지(base64) + 텍스트 혼합 응답을 테스트하는 도구.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `serverId` | string | 서버 ID |

**Output**
- `content[0]`: `{ type: "image", mimeType: "image/png", data: "<base64>" }`
- `content[1]`: `{ type: "text", text: "서버 메트릭 정보" }`

---

### FaultyModule

#### `simulate_api_error`

다양한 에러 유형을 시뮬레이션하는 도구.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `type` | enum | 에러 유형 |

**에러 유형별 동작**
| type | 동작 |
|------|------|
| `soft_fail` | 성공 응답 + `isError: false` + "검색 결과 0건" 텍스트 |
| `hard_500` | `McpError(InternalError)` + `data: { retry_after, retryable }` |
| `auth_fail` | `McpError(InvalidRequest)` + `data: { reason, action }` |
| `timeout` | 무한 대기 (타임아웃 정책 테스트용) |

---

#### `slow_operation`

지정된 시간 후 완료되는 도구. 타임아웃/취소 정책 테스트용.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `seconds` | number | 대기 시간(초) |

**Output**: 완료 메시지

---

### SecureModule

#### `get_my_info`

Hub가 전달한 헤더(사용자 식별/토큰)를 확인하는 도구. 입력 없음.

**Output**: 수신한 헤더 정보 JSON
- `receivedHeaders.userId`: `x-user-id` 헤더 값
- `receivedHeaders.userRole`: `x-user-role` 헤더 값
- `receivedHeaders.hasAuthorization`: Authorization 헤더 존재 여부
- `raw`: 전체 헤더 객체

---

#### `get_salary_info`

HR_MANAGER 권한이 필요한 도구. 권한 체크(Post-check) 테스트용.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `employeeId` | string | 직원 ID |

**동작**
- `x-user-role !== "HR_MANAGER"`: `McpError` + `data: { required_role, current_role }`
- 권한 있음: 급여 정보 텍스트 반환

---

#### `external_api_call`

External MCP 연동 시 Personal Key 주입을 확인하는 도구.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `service` | enum(`jira`, `slack`, `google`) | 외부 서비스 |

**동작**
- 헤더 `x-personal-${service}-key` 없음: `McpError` + `data: { action: "register_key", service }`
- 키 있음: 성공 텍스트 (키 앞 4글자만 노출)

---

#### `get_customer_info`

민감정보 포함 원본 응답을 반환하는 도구. 마스킹 정책 논의용.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `customerId` | string | 고객 ID |

**Output**: 민감정보 포함 JSON (phone, ssn 등 마스킹 없이 반환)

---

### OpsModule

#### `set_server_status`

서버 상태를 active/inactive로 변경하는 관리용 도구.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `status` | enum(`active`, `inactive`) | 변경할 상태 |

**Output**: 현재 상태 JSON

---

#### `status_aware_tool`

서버 상태에 따라 동작이 달라지는 도구. 입력 없음.

**동작**
- 서버가 `inactive`: `McpError` + `data: { status }`
- 서버가 `active`: 정상 응답

---

#### `concurrent_test`

동시 호출 처리/격리를 테스트하는 도구.

**Input**
| 필드 | 타입 | 설명 |
|------|------|------|
| `delay` | number | 대기 시간(초) |

**Output**
- `activeRequests`: 현재 활성 요청 수
- `maxConcurrent`: 최대 동시 요청 수
- `timestamp`: 타임스탬프

---

## Prompt 명세

#### `code_review`

코드 리뷰 요청용 프롬프트 템플릿.

**Arguments**
| 이름 | 타입 | 필수 | 설명 |
|------|------|------|------|
| `language` | string | ✅ | 프로그래밍 언어 |
| `code` | string | ✅ | 리뷰할 코드 |

**Output**: "다음 ${language} 코드를 리뷰해주세요" 형태의 messages 배열

---

## 헤더 규약

Hub는 MCP 서버 호출 시 다음 헤더를 전달해야 합니다:

| 헤더 | 용도 | 사용하는 도구 |
|------|------|---------------|
| `x-user-id` | 사용자 식별 | `get_my_info` |
| `x-user-role` | 사용자 권한 | `get_my_info`, `get_salary_info` |
| `Authorization` | 인증 토큰 | `get_my_info` |
| `x-personal-jira-key` | Jira Personal Key | `external_api_call` |
| `x-personal-slack-key` | Slack Personal Key | `external_api_call` |
| `x-personal-google-key` | Google Personal Key | `external_api_call` |
